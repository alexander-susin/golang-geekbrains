image: malkinfedor/golang-gitlab-image:1.15.1

stages:
  - test
  - build

unit_tests:
  stage: test
  script:
    - go test -short

race_detector:
  stage: test
  script:
    - go test -race -short

memory_sanitizer:
  stage: test
  script:
    - go test -msan -short

#code_coverage:
#  stage: test
#  script:
#    - make coverage

#code_coverage_report:
#  stage: test
#  script:
#    - make coverhtml
#  only:
#  - master

#lint_code:
#  stage: test
#  script:
#    - golint -set_exit_status

#build:
#  stage: build
#  artifacts:
#    paths:
#      - golang-helloworld
#    expire_in: 1 week
#  script:
#    - go build -i -v

docker-build:
  image: docker:19.03.13
  services:
    - docker:19.03.13-dind
  stage: build
  script:
    - docker build -t golang_hello-world:${CI_COMMIT_REF_SLUG} .
    - docker run golang_hello-world:${CI_COMMIT_REF_SLUG}
